window.__require=function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var r=a.split("/");if(r=r[r.length-1],!e[r]){var h="function"==typeof __require&&__require;if(!s&&h)return h(r,!0);if(c)return c(r,!0);throw new Error("Cannot find module '"+a+"'")}}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){return o(e[a][1][t]||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var c="function"==typeof __require&&__require,a=0;a<i.length;a++)o(i[a]);return o}({CarMover:[function(t,e,n){"use strict";cc._RF.push(e,"39b36+CWHNHKZd6FV0qd4hv","CarMover");var i=cc.Enum({Left:0,Right:1}),o=cc.Class({extends:cc.Component,properties:{direction:{default:0,tooltip:"\u8fd0\u52a8\u65b9\u5411\uff0c0\u4e3a\u5de6\uff0c1\u4e3a\u53f3"},speed:100,carName:"",_line:0,_side:null},statics:{Dir:i},start:function(){D.Car=o,this.anim=this.getComponent(cc.Animation),this.yMin=this.node.getBoundingBoxToWorld().yMin+20;var t=this.speed/100;this.anim.play("roll-wheel").speed=t,this.init()},update:function(t){if(this.direction===i.Right){if(this.node.getBoundingBoxToWorld().xMin>D.windowSize.width)return void this.destroySelf();this.node.x+=this.speed*t}else{if(this.node.getBoundingBoxToWorld().xMax<0)return void this.destroySelf();this.node.x-=this.speed*t}this.tomaPassed||this.ifTomaHasPassed()},onDestroy:function(){this.cancelListener()},init:function(){this.node.active=!0,this.tomaPassed=!1,this.node.zIndex=5-this._line,this.registerEvent()},destroySelf:function(){this.cancelListener(),D.carManager.destroyCar(this,this._line)},ifTomaHasPassed:function(){this.yMin<D.toma.node.getBoundingBoxToWorld().yMin&&(this.tomaPassed=!0,this.node.zIndex=this.node.zIndex+100)},_tomaBackHandler:function(){this.tomaPassed=!1,this.node.zIndex=5-this._line},registerEvent:function(){D.toma.node.on("tomaBack",this._tomaBackHandler,this)},cancelListener:function(){D.toma.node.off("tomaBack",this._tomaBackHandler,this)},setLine:function(t){this._line=t},getLine:function(){return this._line},whichSide:function(){}});cc._RF.pop()},{}],GameController:[function(t,e,n){"use strict";cc._RF.push(e,"b957bbyFoJEfpHBG2acCZt2","GameController"),t("global"),cc.Class({extends:cc.Component,properties:{dieMenu:cc.Node,playgrounds:[cc.Node],gameScore:cc.Node,menuScore:cc.Node,highScore:cc.Node},onLoad:function(){var t=this;cc.view.resizeWithBrowserSize(!0),cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE),this.getSize(),cc.view.setResizeCallback(function(){t.getSize()}),D.game=this,D.playgrounds=this.playgrounds,this.dieMenuAnim=this.dieMenu.getComponent(cc.Animation),this._menuScoreLabel=this.menuScore.getComponent(cc.Label),this._highScoreLabel=this.highScore.getComponent(cc.Label)},getSize:function(){D.windowSize=cc.view.getVisibleSize(),console.log("screen size: ",D.windowSize)},onRestart:function(){D.carManager.init(),this.gameScore.opacity=255,this.dieMenu.active=!1,D.toma.init()},gameOver:function(){var t=this;this._menuScoreLabel.string="Score: "+D.score;var e=Math.max(D.score,D.highScore);D.highScore=e,this._highScoreLabel.string="Best: "+e,setTimeout(function(){t.gameScore.opacity=0,t.dieMenu.active=!0,t.dieMenuAnim.play("slide-down")},1e3)}}),cc._RF.pop()},{global:"global"}],Pool:[function(t,e,n){"use strict";cc._RF.push(e,"9d36dugiVBLIoVjGNpYkdwI","Pool");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};cc.Class({extends:cc.Component,properties:{_pool:null},ctor:function(){this._pool=new cc.js.Pool(function(t){},5),this._pool.get=this.get},get:function(t){for(var e=0;e<this.count;e++){var n=this._get();if(n instanceof t)return n}},spawn:function(t,e,n,o){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=this._pool.get(e);return null===c?a||(a=cc.instantiate(t).getComponent(e)):a=c(a),o?a.node.parent=o:this.node.addChild(a.node),"object"!==(void 0===n?"undefined":i(n))?a.node.x=n:(a.node.x=n.x,a.node.y=n.y),a.node.active=!0,a},despawn:function(t){t.node.removeFromParent(),t.node.active=!1,this.putIntoPool(t)},putIntoPool:function(t){var e=this._pool.count;return this._pool.put(t),e<this._pool.count||(console.warn("pool has been filled, please resize the array length."),!1)}}),cc._RF.pop()},{}],carManager:[function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}cc._RF.push(e,"244adltTLxJFreZoj2RZfaw","carManager");var o=t("./cars/carMini"),c=t("./cars/carRun"),a=t("./cars/carTruck"),s=t("./cars/CarMover");cc.Class({extends:cc.Component,properties:{carPrefabs:[cc.Prefab],spawnInterval:5,_cars:[],_lineNum:4,_schedulers:[]},onLoad:function(){D.carManager=this,this._lineNum=4},start:function(){this.init()},onDestroy:function(){this.cancelListener()},init:function(){this.registerEvent(),this.clearCar(D.curPlayground),this.spawn()},spawn:function(){for(var t=this,e=0;e<this._lineNum;e++){var n=new Array;this._cars.push(n),this.randPick(e+1),this.randPick(e+1)}for(var i=function(e){t.spawnFirstCar(e+1),setTimeout(function(){t.spawnCar(e+1);var n=function(){return t.spawnCar(e+1)};t._schedulers.push(n),t.schedule(n,t.spawnInterval)},300*e)},o=0;o<this._lineNum;o++)i(o)},clearCar:function(t){var e=this;this._schedulers.forEach(function(t){e.unschedule(t)}),this._schedulers=[],[].concat(i(D.playgrounds[t].children)).forEach(function(t){"car"===t.name.substr(0,3)&&t.getComponent(s).destroySelf()}),this._cars=[]},destroyCar:function(t,e){D.carPool["l"+e].despawn(t)},spawnFirstCar:function(t){this.randPick(t);var e=this._cars[t-1][0];D.carPool["l"+t].spawnCar(e.prefab,e.comp,t%2?cc.v2(D.windowSize.width/2+this.node.width+100,200+160*(t-1)):cc.v2(D.windowSize.width/2-this.node.width-100,200+160*(t-1)),D.playgrounds[D.curPlayground],t),this._cars[t-1].shift()},spawnCar:function(t){if(this.randPick(t),!(this._cars[t-1][1].comp!==c&&this._cars[t-1][2].comp===c||this._cars[t-1][0].comp===a&&this._cars[t-1][1].comp!==a)){var e=this._cars[t-1][1];D.carPool["l"+t].spawnCar(e.prefab,e.comp,t%2?cc.v2(D.windowSize.width+this.node.width/2,200+160*(t-1)):cc.v2(0,200+160*(t-1)),D.playgrounds[D.curPlayground],t)}this._cars[t-1].shift()},randPick:function(t){var e=Math.floor(10*Math.random()+1),n={};e<=6?t%2==0?(n.prefab=this.carPrefabs[0],n.comp=o):(n.prefab=this.carPrefabs[1],n.comp=o):e<=8?t%2==0?(n.prefab=this.carPrefabs[2],n.comp=c):(n.prefab=this.carPrefabs[3],n.comp=c):t%2==0?(n.prefab=this.carPrefabs[4],n.comp=a):(n.prefab=this.carPrefabs[5],n.comp=a),this._cars[t-1].push(n)},_changeGroundHandler:function(){this.clearCar(D.curPlayground?0:1),this.spawn()},registerEvent:function(){D.toma.node.on("changeGround",this._changeGroundHandler,this)},cancelListener:function(){D.toma.node.off("changeGround",this._changeGroundHandler,this)}}),cc._RF.pop()},{"./cars/CarMover":"CarMover","./cars/carMini":"carMini","./cars/carRun":"carRun","./cars/carTruck":"carTruck"}],carMini:[function(t,e,n){"use strict";cc._RF.push(e,"f32499iRMVF1qQsjUsWexdr","carMini");var i=t("CarMover");cc.Class({extends:i}),cc._RF.pop()},{CarMover:"CarMover"}],carPool:[function(t,e,n){"use strict";cc._RF.push(e,"a62716abKhGY65ZKQ+aU0bC","carPool");var i=t("Pool");cc.Class({extends:i,properties:{},onLoad:function(){},start:function(){},spawnCar:function(t,e,n,i,o){this.spawn(t,e,n,i,function(n){return n?n.init():(n=cc.instantiate(t).getComponent(e)).setLine(o),n})}}),cc._RF.pop()},{Pool:"Pool"}],carRun:[function(t,e,n){"use strict";cc._RF.push(e,"29ab3YF10dL7JLuRIUTxMGf","carRun");var i=t("CarMover");cc.Class({extends:i}),cc._RF.pop()},{CarMover:"CarMover"}],carTruck:[function(t,e,n){"use strict";cc._RF.push(e,"c1169eiNv9EkbW7nkOvzJxM","carTruck");var i=t("CarMover");cc.Class({extends:i}),cc._RF.pop()},{CarMover:"CarMover"}],global:[function(t,e,n){"use strict";cc._RF.push(e,"6bc53N2vh5EF4LwuqiRIyzE","global"),window.D={game:null,toma:null,carPool:{l1:null,l2:null,l3:null,l4:null},windowSize:null,carManager:null,Car:null,score:0,highScore:0,curPlayground:0,playgrounds:null},cc._RF.pop()},{}],loadingController:[function(t,e,n){"use strict";cc._RF.push(e,"2b16807hDBF8pvhh+eVg4zl","loadingController"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.director.preloadScene("Entry",function(){cc.director.preloadScene("Main",function(){cc.director.loadScene("Entry")})})}}),cc._RF.pop()},{}],playgroundController:[function(t,e,n){"use strict";cc._RF.push(e,"4da30owASFN1rNZG1auD0i6","playgroundController"),cc.Class({extends:cc.Component,properties:{},start:function(){},onRoadChanged:function(){D.toma.closeInvincible()}}),cc._RF.pop()},{}],poolManager:[function(t,e,n){"use strict";cc._RF.push(e,"92305Yd2VNOwK5BhJpy83i2","poolManager");var i=t("carPool");cc.Class({extends:cc.Component,properties:{},onLoad:function(){D.carPool.l1=new i,D.carPool.l2=new i,D.carPool.l3=new i,D.carPool.l4=new i},start:function(){}}),cc._RF.pop()},{carPool:"carPool"}],startController:[function(t,e,n){"use strict";cc._RF.push(e,"a9233/RBlRDQ6wJAjToRHRD","startController"),cc.Class({extends:cc.Component,properties:{},onStartClick:function(){cc.director.loadScene("Main")}}),cc._RF.pop()},{}],tomaController:[function(t,e,n){"use strict";cc._RF.push(e,"e3f37SjKhpH14MmiyhTcvst","tomaController");var i=t("./cars/CarMover"),o=cc.Enum({None:0,Walk:1,LeftWatch:2,RightWatch:3,Dead:4});cc.Class({extends:cc.Component,properties:{collision:{default:!1,tooltip:"\u662f\u5426\u68c0\u6d4b\u78b0\u649e"},mask:{default:!1,tooltip:"\u662f\u5426\u6253\u5f00\u89c6\u89c9\u969c\u788d"},speed:10,touchLeft:cc.Node,touchRight:cc.Node,maskLeft:cc.Node,maskRight:cc.Node,counterLabel:cc.Node,state:{default:o.None,type:o,visible:!1},_actionInPlan:null,_died:!1,_invincible:!1},onLoad:function(){D.toma=this},start:function(){this._counter=this.counterLabel.getComponent(cc.Label),this.anim=this.getComponent(cc.Animation),this.node.zIndex=10,cc.director.getCollisionManager().enabled=this.collision,this.maskLeftAnim=this.maskLeft.getComponent(cc.Animation),this.maskRightAnim=this.maskRight.getComponent(cc.Animation),this._playgroundAnim=[],this._playgroundAnim.push(D.playgrounds[0].getComponent(cc.Animation)),this._playgroundAnim.push(D.playgrounds[1].getComponent(cc.Animation)),this._normalCollider=this.getComponents(cc.Collider)[0],this._dieCollider=this.getComponents(cc.Collider)[1],D.curPlayground=0,this.closeInvincible(),this.init()},update:function(t){switch(this.state){case o.Walk:this.node.y+=this.speed*t,this.node.getBoundingBox().yMin>D.windowSize.height&&(this.setPoint(),this.goBack());break;case o.None:case o.Dead:}},onDestroy:function(){this.cancelTouch()},onCollisionEnter:function(t,e){var n=this;switch(cc.game.groupList[t.node.groupIndex]){case"car":if(!this._invincible){var c=t.getComponent(i);if(this.state===o.Dead){this._died&&(this._actionInPlan=setTimeout(function(){n.anim.play("toma-die-after")},300));break}c.direction===D.Car.Dir.Right?this.die("l"):this.die("r"),D.game.gameOver()}}},init:function(){this.registerTouch(),this.state===o.Dead&&this.setPoint(!0),this._actionInPlan&&clearTimeout(this._actionInPlan),this._actionInPlan=null,this.mask&&(this.maskLeftAnim.play("fadein"),this.maskRightAnim.play("fadein")),this._died=!1,this.node.zIndex=6,this.stay(),this.goBack(!0),this._normalCollider.enabled=!0,this._dieCollider.enabled=!1},walk:function(){this.setState(o.Walk),this.anim.play("toma-go-middle"),this.toggleMask(-1)},stay:function(){this.setState(o.None),this.anim.play("toma-idle")},turnLeft:function(){this.state!==o.LeftWatch&&(this.setState(o.LeftWatch),this.anim.play("toma-turn-left")),this.toggleMask(0)},turnRight:function(){this.state!==o.RightWatch&&(this.setState(o.RightWatch),this.anim.play("toma-turn-right")),this.toggleMask(1)},toggleMask:function(t){if(this.mask)switch(t){case 1:this.maskLeft.opacity=255,this.maskRight.opacity=0;break;case 0:this.maskRight.opacity=255,this.maskLeft.opacity=0;break;case-1:this.maskLeft.opacity=255,this.maskRight.opacity=255;break;case 2:default:this.maskLeft.opacity=0,this.maskRight.opacity=0}},_keyDownHandler:function(t){switch(t.keyCode){case cc.macro.KEY.left:this.turnLeft();break;case cc.macro.KEY.right:this.turnRight()}},_keyUpHandler:function(t){switch(t.keyCode){case cc.macro.KEY.left:this.state===o.LeftWatch&&this.walk();break;case cc.macro.KEY.right:this.state===o.RightWatch&&this.walk();break;default:this.walk()}},registerTouch:function(){var t=this;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this._keyDownHandler,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this._keyUpHandler,this),this.touchLeft.on(cc.Node.EventType.TOUCH_START,function(){t.turnLeft()}),this.touchLeft.on(cc.Node.EventType.TOUCH_END,function(){t.state===o.LeftWatch&&t.walk()}),this.touchRight.on(cc.Node.EventType.TOUCH_START,function(){t.turnRight()}),this.touchRight.on(cc.Node.EventType.TOUCH_END,function(){t.state===o.RightWatch&&t.walk()})},cancelTouch:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this._keyDownHandler,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this._keyUpHandler,this),this.touchLeft.off(cc.Node.EventType.TOUCH_START),this.touchLeft.off(cc.Node.EventType.TOUCH_END),this.touchRight.off(cc.Node.EventType.TOUCH_START),this.touchRight.off(cc.Node.EventType.TOUCH_END)},setState:function(t){t!==this.state&&(this.state=t)},goBack:function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){this.openInvincible();var t=D.curPlayground;D.curPlayground=D.curPlayground?0:1,this._playgroundAnim[D.curPlayground].play("bg-slide-in"),this._playgroundAnim[t].play("bg-slide-out"),this.node.emit("changeGround")}this.node.parent=D.playgrounds[D.curPlayground],this.node.y=0,this.stay(),this.node.emit("tomaBack")},setPoint:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?D.score=0:D.score++,this._counter.string="Score: "+D.score},closeInvincible:function(){this._invincible=!1},openInvincible:function(){this._invincible=!0},die:function(t){this.toggleMask(2);var e="toma-"+t+"die";this.state=o.Dead,this.anim.play(e),this.cancelTouch(),this._normalCollider.enabled=!1,this._dieCollider.enabled=!0},onDieOver:function(){this._died=!0,this.node.zIndex=0}}),cc._RF.pop()},{"./cars/CarMover":"CarMover"}]},{},["GameController","loadingController","Pool","startController","carManager","carPool","CarMover","carMini","carRun","carTruck","global","playgroundController","poolManager","tomaController"]);